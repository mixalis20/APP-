<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/frontend/style.css">
    <title>Upload Image with Annotations</title>
</head>
<body>

    <div class="navbar">
        <ul>
            <li><a href="index.html"> Image</a></li>
            <li><a href="gallery.html"> Gallery</a></li>
        </ul>
    </div>
    <h1>Upload Image with Annotations</h1>
    <div class="upload-container">
        <!-- Εισαγωγή εικόνας -->
        <input type="file" id="upload" accept="image/*">
        
        <!-- Κουμπί αποθήκευσης -->
        <button id="saveButton">Save Image with Annotations</button>

        <!-- Κουμπί Resize -->
        <button id="resizeButton">Resize Image</button>

        <!-- Εισαγωγή διαστάσεων για το resize -->
        <div id="resizeInputs" style="display: none;">
            <input type="number" id="newWidth" placeholder="New Width" min="1">
            <input type="number" id="newHeight" placeholder="New Height" min="1">
            <button id="applyResize">Apply Resize</button>
        </div>
    </div>
<!-- Canvas για την εμφάνιση της εικόνας και των annotations -->
<canvas id="canvas"></canvas>
    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        let image = new Image();
        let annotations = [];
        let isDrawing = false;
        let startX, startY, endX, endY;

        document.getElementById('upload').addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    image.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        image.onload = () => {
            canvas.width = image.width;
            canvas.height = image.height;
            ctx.drawImage(image, 0, 0);
        };

        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
        });

        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            endX = e.clientX - rect.left;
            endY = e.clientY - rect.top;
            ctx.drawImage(image, 0, 0);
            ctx.strokeStyle = 'red';
            ctx.lineWidth = 2;
            ctx.strokeRect(startX, startY, endX - startX, endY - startY);
        });

        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
            const title = prompt('Enter annotation title:');
            const description = prompt('Enter annotation description:');
            annotations.push({
                x: Math.min(startX, endX),
                y: Math.min(startY, endY),
                width: Math.abs(endX - startX),
                height: Math.abs(endY - startY),
                title,
                description,
            });
            ctx.drawImage(image, 0, 0);
            annotations.forEach(annotation => {
                ctx.strokeStyle = 'blue';
                ctx.lineWidth = 2;
                ctx.strokeRect(annotation.x, annotation.y, annotation.width, annotation.height);
                ctx.font = '12px Arial';
                ctx.fillText(annotation.title, annotation.x, annotation.y - 5);
            });
        });

        document.getElementById('saveButton').addEventListener('click', async () => {
            const imageData = canvas.toDataURL();
            try {
                const response = await fetch('http://localhost:5000/api/images', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData, annotations }),
                });
                if (response.ok) {
                    alert('Image and annotations saved successfully!');
                } else {
                    alert('Failed to save image and annotations');
                }
            } catch (error) {
                console.error('Error saving image and annotations:', error);
            }
        });
    </script>
</body>
</html>
